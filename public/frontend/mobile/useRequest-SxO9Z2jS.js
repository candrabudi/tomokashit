import{d as U,dk as ne,dl as oe,c as ve,aW as fe,y as me,o as E,l as R,r as N,n as v,s as P,u as b,D as j,x as V,q as X,J as M,e as Z,cS as he,dM as pe,f as n,d7 as ge,h as A,z as J,dt as _e,dN as Te,d8 as ye,cW as be,aC as G,A as Be,dv as te,d6 as we,j as Ie,k as Se,L as xe,C as se,g as O,v as $,w as H,aj as Le,bk as Ee,aB as ke,a7 as Ne,a as ae,m as $e,aF as q,F as W,N as De}from"./index-kWXyNMgS.js";import{_ as Pe}from"./index.vue_vue_type_script_setup_true_lang-BsAk-9xl.js";import{_ as Re}from"./ImageSfc-BKbCF4Sw.js";import{e as Ce}from"./logger-RF2tOY5E.js";const le={loading:Boolean,immediateCheck:{type:Boolean,default:!0},finished:Boolean,error:Boolean,offset:{type:[String,Number],default:0},loadingText:String,finishedText:String,errorText:String,onLoad:U(),"onUpdate:loading":U(),"onUpdate:error":U()},re=Symbol("TABS_ITEMS_BIND_TAB_ITEM_KEY");function ft(){const{bindChildren:e,childProviders:t,length:o}=ne(re);return{length:o,tabItemList:t,bindTabItem:e}}const ie=Symbol("TAB_ITEM_BIND_LIST_KEY");function mt(){const{parentProvider:e,bindParent:t,index:o}=oe(re);return t||Ce("TabItem","<var-tab-item/> must in <var-tabs-items/>"),{index:o,tabsItems:e,bindTabsItems:t}}function ht(){const{childProviders:e,bindChildren:t,length:o}=ne(ie);return{length:o,lists:e,bindLists:t}}function Me(){const{parentProvider:e,bindParent:t,index:o}=oe(ie);return{index:o,tabItem:e,bindTabItem:t}}var Fe=(e,t,o)=>new Promise((a,l)=>{var d=r=>{try{s(o.next(r))}catch(f){l(f)}},u=r=>{try{s(o.throw(r))}catch(f){l(f)}},s=r=>r.done?a(r.value):Promise.resolve(r.value).then(d,u);s((o=o.apply(e,t)).next())});const{name:Ye,n:ze,classes:Ae}=ve("list");function Xe(e,t){const o=fe("var-loading"),a=me("ripple");return E(),R("div",{class:P(e.classes(e.n(),e.n("$--box"))),ref:"listEl"},[N(e.$slots,"default"),e.loading?N(e.$slots,"loading",{key:0},()=>{var l;return[v("div",{class:P(e.n("loading"))},[v("div",{class:P(e.n("loading-text"))},b((l=e.loadingText)!=null?l:(e.pt?e.pt:e.t)("listLoadingText")),3),j(o,{size:"mini",radius:10})],2)]}):V("v-if",!0),e.finished?N(e.$slots,"finished",{key:1},()=>{var l;return[v("div",{class:P(e.n("finished"))},b((l=e.finishedText)!=null?l:(e.pt?e.pt:e.t)("listFinishedText")),3)]}):V("v-if",!0),e.error?N(e.$slots,"error",{key:2},()=>{var l;return[X((E(),R("div",{class:P(e.n("error")),onClick:t[0]||(t[0]=(...d)=>e.load&&e.load(...d))},[M(b((l=e.errorText)!=null?l:(e.pt?e.pt:e.t)("listErrorText")),1)],2)),[[a]])]}):V("v-if",!0),v("div",{class:P(e.n("detector")),ref:"detectorEl"},null,2)],2)}const ue=Z({name:Ye,directives:{Ripple:he},components:{VarLoading:pe},props:le,setup(e){const t=n(null),o=n(null),{tabItem:a,bindTabItem:l}=Me(),{t:d}=ge();let u;A(l,{}),a&&J(()=>a.current.value,m),J(()=>[e.loading,e.error,e.finished],m),_e(()=>{u=G(t.value),u.addEventListener("scroll",m),e.immediateCheck&&m()}),Te(f);function s(){A(e["onUpdate:error"],!1),A(e["onUpdate:loading"],!0),A(e.onLoad)}function r(){const{bottom:g}=te(u),{bottom:_}=te(o.value);return Math.floor(_)-we(e.offset)<=g}function f(){u&&u.removeEventListener("scroll",m)}function m(){return Fe(this,null,function*(){yield Be(),!(e.loading||e.finished||e.error||(a==null?void 0:a.current.value)===!1||!r())&&s()})}return{listEl:t,detectorEl:o,pt:d,t:ye,isNumber:be,load:s,check:m,n:ze,classes:Ae}}});ue.render=Xe;var ee=ue;Ie(ee);Se(ee,le);const He=ee,ce="/assets/image/loading_pull.png",je="/assets/image/loading_pull_before.png",Ke={class:"py-90px"},Ue={class:"text-center"},Ve={class:"mb-[28px] ml-[50%] w-[fit-content] translate-x-[-50%]"},qe={class:"my-10px text-32px color-text font-bold"},We={class:"my-10px text-24px color-text font-normal"},Je={class:"mx-auto my-10px max-w-504px text-24px color-text-sub font-normal"},Ge=Z({__name:"FBError",props:{message:{type:String,default:""}},setup(e){const t=e,o=xe(),{t:a}=se(),l=O(()=>{const u=/\[(\d+)-(\d+)\]/,s=t.message.match(u);if(s&&s.length===3){const r=Number.parseInt(s[2]);return Ee(r,"MM/DD HH:mm")}else return""});function d(){o.push("/?tab=game")}return(u,s)=>{const r=Re,f=Le;return E(),R("div",Ke,[v("div",Ue,[v("div",Ve,[N(u.$slots,"image",{},()=>[j(r,{class:"h-[230px] w-[420px]",src:"/assets/image/maintenance@2x.png"})])]),v("h3",qe,b($(a)("component.verList.FBError.title")),1),v("h5",We,b($(a)("component.verList.FBError.endAt"))+" "+b(l.value),1),v("h5",Je,b($(a)("component.verList.FBError.content")),1),j(f,{type:"primary",class:"mx-auto mt-50px h-70px w-330px",onClick:d},{default:H(()=>[M(b($(a)("component.verList.FBError.button")),1)]),_:1})])])}}});function Q(e){const t="scrollTop"in e?e.scrollTop:e.scrollY;return Math.max(t,0)}function Oe(e,t){if(e>t)return"horizontal";if(t>e)return"vertical"}function Qe(){const e=n(0),t=n(0),o=n(0),a=n(0),l=n(0),d=n(0),u=n(0),s=n(0),r=n(0),f=n(0),m=n(),g=n(!1),_=n(!1),L=n(0),I=n(0);let k=null;const c=()=>{e.value=0,t.value=0,o.value=0,a.value=0,l.value=0,d.value=0,u.value=0,s.value=0,r.value=0,f.value=0,m.value=void 0,g.value=!1,_.value=!1,L.value=0,I.value=0};return{startX:e,startY:t,deltaX:o,deltaY:a,offsetX:l,offsetY:d,prevX:u,prevY:s,moveX:r,moveY:f,direction:m,touching:g,dragging:_,startTime:L,distance:I,resetTouch:c,startTouch:T=>{c();const{clientX:p,clientY:x}=T.touches[0];e.value=p,t.value=x,u.value=p,s.value=x,g.value=!0,L.value=performance.now(),_.value=!1,k&&window.cancelAnimationFrame(k)},moveTouch:T=>{const{clientX:p,clientY:x}=T.touches[0];_.value=!0,o.value=p-e.value,a.value=x-t.value,l.value=Math.abs(o.value),d.value=Math.abs(a.value),I.value=Math.sqrt(l.value**2+d.value**2),r.value=p-u.value,f.value=x-s.value,m.value||(m.value=Oe(l.value,d.value)),u.value=p,s.value=x},endTouch:()=>{g.value=!1,k=window.requestAnimationFrame(()=>{_.value=!1})},isReachTop:T=>Q(T)===0&&a.value>0,isReachBottom:(T,p=1)=>{const{scrollHeight:x,clientHeight:K,scrollTop:F}=T,Y=Math.abs(x-F-K);return a.value<0&&Y<=p}}}const Ze={class:"h-[230px] flex flex-col items-center justify-center"},et={class:"h-100 w-200",src:ce},tt={class:"h-100 w-200",src:je},at={class:"text-24 color-text font-500 opacity-30"},nt={class:"flex flex-col items-center justify-center"},ot=v("img",{class:"h-100 w-200",src:ce},null,-1),st={class:"text-24 color-text font-500 opacity-30"},lt=v("div",{class:"h-50 w-full"},null,-1),rt=v("div",{class:"h-[env(safe-area-inset-bottom)] w-full"},null,-1),pt=Z({__name:"index",props:{loading:{type:Boolean},finished:{type:Boolean},empty:{type:Boolean},emptyTitle:{},emptyDesc:{},emptyImage:{},error:{type:Boolean},errorInfo:{},immediateCheck:{type:Boolean,default:!1},loadingText:{},finishedText:{},offset:{default:"10vh"},pullRefreshEnable:{type:Boolean,default:!1}},emits:["load","refresh"],setup(e,{expose:t,emit:o}){const a=e,l=o,{t:d}=se();function u(){l("load")}const s=O(()=>{var i;return a.error&&((i=a.errorInfo)==null?void 0:i.code)===8}),{startTouch:r,moveTouch:f,endTouch:m,isReachTop:g}=Qe(),_=i=>i===window;function L(i){if(_(i)){const D=i.innerWidth,y=i.innerHeight,z={x:0,y:0,top:0,left:0,right:D,bottom:y,width:D,height:y};return{...z,toJSON:()=>z}}return i.getBoundingClientRect()}const I=n(null),k=n(null),c=n("default"),B=n(0),w=n(0),h=n(0),S=O(()=>c.value!=="loading"&&c.value!=="success"&&a.pullRefreshEnable);let C=null;J(()=>a.loading,i=>{if(!i&&c.value==="loading"){let y=Date.now()-C;y>1e3&&(y=0),setTimeout(()=>{c.value="success",setTimeout(()=>{c.value="loosing",h.value=0},500)},y)}});let T,p;ke(()=>{T=G(I.value),T.addEventListener("touchmove",K,{passive:!1,capture:!1})});function x(i){if(r(i),w.value===0){const{height:D}=L(k.value);w.value=D}B.value=i.touches[0].clientY,p=G(i.target)}function K(i){if(f(i),!S.value||!p||p!==T&&Q(p)>0||Q(T)>0)return;(g(T)||c.value==="pulling")&&i.cancelable!==!1&&i.preventDefault();const y=(i.touches[0].clientY-B.value)/2;h.value=y>=w.value?w.value:y,h.value>=w.value?c.value="reach":y>10&&(c.value="pulling")}function F(){m(),S.value&&(h.value>=w.value?(C=Date.now(),c.value="loading",h.value=w.value,l("refresh")):(c.value="loosing",h.value=0),p=null)}const Y=n(null);function de(){Y.value.check()}return t({check:de}),(i,D)=>{const y=Pe,z=He;return E(),R("div",{ref_key:"freshNode",ref:I,onTouchstart:x,onTouchend:F,onTouchcancel:F},[v("div",{class:P(["relative overflow-hidden bg-body",{"transition-all transition-duration-200":c.value==="loosing"}]),style:Ne({height:"".concat(h.value,"px")})},[v("div",{ref_key:"controlNode",ref:k,class:"absolute bottom-0 w-full"},[N(i.$slots,"pullRefresh",{status:c.value},()=>[v("div",Ze,[X(v("img",et,null,512),[[q,c.value==="loading"]]),X(v("img",tt,null,512),[[q,c.value!=="loading"]]),v("div",at,[c.value==="reach"?(E(),R(W,{key:0},[M(b($(d)("component.verList.releaseToRefresh")),1)],64)):c.value==="loading"?(E(),R(W,{key:1},[M(b($(d)("component.verList.loading")),1)],64)):(E(),R(W,{key:2},[M(b($(d)("component.verList.pullDownToRefresh")),1)],64))])])])],512)],6),s.value?(E(),ae(Ge,{key:0,message:a.errorInfo.message},null,8,["message"])):a.error||a.empty?N(i.$slots,"empty",{key:1},()=>[j(y,{title:a.emptyTitle,desc:a.emptyDesc,image:a.emptyImage},null,8,["title","desc","image"])]):(E(),ae(z,$e({key:2,ref_key:"varListRef",ref:Y},a,{onLoad:u}),{loading:H(()=>[X(v("div",nt,[ot,v("div",st,b($(d)("component.verList.loading")),1)],512),[[q,c.value!=="loading"]])]),finished:H(()=>[lt]),default:H(()=>[N(i.$slots,"default")]),_:3},16)),rt],544)}}});function it(e){return e.list.length>=e.total||e.currentPageList.length<e.pageSize}function gt(e,t){const{listKey:o="list",params:a,isFinished:l=it,immediate:d=!0,onError:u}=t||{},s=De({current:0,pageSize:20,total:0}),r=n([]),f=n(!1),m=n(!1),g=n(!1),_=n(!1),L=n(null),I=async()=>{var w;if(f.value||m.value)return;f.value=!0,s.current++;let B={pageSize:s.pageSize,current:s.current,...a};t!=null&&t.onBefore&&(B=await((w=t==null?void 0:t.onBefore)==null?void 0:w.call(t,B))),await e(B).then(h=>{var C;const S=h.data[o];s.current===1?S!=null&&S.length?r.value=S:g.value=!0:r.value.push(...S),l({list:r.value,currentPageList:S,total:h.data.total,pageSize:B.pageSize})&&(m.value=!0),h.data.total!==null&&(s.total=h.data.total),(C=t==null?void 0:t.onSuccess)==null||C.call(t,h.data,B)}).catch(h=>{_.value=!0,u&&u(h),L.value=h,r.value.length?m.value=!0:g.value=!0}).finally(()=>{f.value=!1})};d?I():g.value=!0;function k(B=!0){if(!f.value)return s.current=0,s.total=0,m.value=!1,g.value=!1,_.value=!1,L.value=null,B&&(r.value=[]),I()}function c(){return I()}return{data:r,loading:f,finished:m,empty:g,error:_,errorInfo:L,pagination:s,reload:k,loadNextPage:c}}export{pt as _,mt as a,ht as b,ft as c,gt as u};

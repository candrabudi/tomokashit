import{dR as I,dS as L,h as k,dq as R,dT as W,dU as N,dV as S}from"./index-kWXyNMgS.js";var C=Object.defineProperty,g=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,z=(t,e,r)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,B=(t,e)=>{for(var r in e||(e={}))G.call(e,r)&&z(t,r,e[r]);if(g)for(var r of g(e))T.call(e,r)&&z(t,r,e[r]);return t},d=(t,e,r)=>new Promise((n,o)=>{var c=i=>{try{m(r.next(i))}catch(p){o(p)}},A=i=>{try{m(r.throw(i))}catch(p){o(p)}},m=i=>i.done?n(i.value):Promise.resolve(i.value).then(c,A);m((r=r.apply(t,e)).next())});const V="background-image",D="lazy-loading",M="lazy-error",E="lazy-attempt",Y=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],y="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",s=[],u=[],O=S(100),a={loading:y,error:y,attempt:3,throttleWait:300,events:Y};let _=L(l,a.throttleWait);function f(t,e){t._lazy.arg===V?t.style.backgroundImage="url(".concat(e,")"):t.setAttribute("src",e)}function Z(t){t._lazy.loading&&f(t,t._lazy.loading),l()}function j(t){t._lazy.error&&f(t,t._lazy.error),t._lazy.state="error",v(t),l()}function w(t,e){f(t,e),t._lazy.state="success",v(t),l()}function U(t){var e;u.includes(t)||(u.push(t),(e=a.events)==null||e.forEach(r=>{t.addEventListener(r,_,{passive:!0})}))}function q(){u.forEach(t=>{var e;(e=a.events)==null||e.forEach(r=>{t.removeEventListener(r,_)})}),u.length=0}function x(t,e){var r,n;const o={loading:(r=t.getAttribute(D))!=null?r:a.loading,error:(n=t.getAttribute(M))!=null?n:a.error,attempt:t.getAttribute(E)?Number(t.getAttribute(E)):a.attempt};t._lazy=B({src:e.value,arg:e.arg,currentAttempt:0,state:"pending",attemptLock:!1},o),f(t,y),k(a.filter,t._lazy)}function H(t,e){const r=new Image;r.src=e,t._lazy.preloadImage=r,r.addEventListener("load",()=>{t._lazy.attemptLock=!1,O.add(e),w(t,e)}),r.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?j(t):P(t)})}function P(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:e}=t._lazy;if(O.has(e)){w(t,e),t._lazy.attemptLock=!1;return}Z(t),H(t,e)}function h(t){return d(this,null,function*(){yield R(),W(t)&&P(t)})}function l(){s.forEach(t=>h(t))}function K(t){return d(this,null,function*(){!s.includes(t)&&s.push(t),N(t).forEach(U),yield h(t)})}function v(t){I(s,t),s.length===0&&q()}function Q(t,e){const{src:r,arg:n}=t._lazy;return r!==e.value||n!==e.arg}function b(t,e){return d(this,null,function*(){x(t,e),yield K(t)})}function X(t,e){return d(this,null,function*(){if(!Q(t,e)){s.includes(t)&&(yield h(t));return}yield b(t,e)})}function $(t={}){const{events:e,loading:r,error:n,attempt:o,throttleWait:c,filter:A}=t;a.events=e!=null?e:a.events,a.loading=r!=null?r:a.loading,a.error=n!=null?n:a.error,a.attempt=o!=null?o:a.attempt,a.throttleWait=c!=null?c:a.throttleWait,a.filter=A}const F={mounted:b,unmounted:v,updated:X,install(t,e){$(e),_=L(l,a.throttleWait),t.directive("lazy",this)}};var tt=F;export{tt as s};
